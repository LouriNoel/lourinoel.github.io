<!DOCTYPE html>
<html>
	<head>
		<title>TP3 XHR</title>
		<meta charset="utf-8">
		<base href="../../index.html"/>
		<link rel="stylesheet" type="text/css" href="style.css">
		
		<style>
			#canvas {
				outline: black 3px solid;
				display: block;
				padding: 0px;
				margin: 0px auto;
			}
		</style>
		
		<script>
		class Circle {
				constructor(ctx, x, y, r, color) {
					this.ctx = ctx;
					this.x = x;
					this.y = y;
					this.r = r;
					this.color = color;
				}
				
				setPosition(x, y){
					this.x = x;
					this.y = y;
				}
			
				draw(){
					ctx.fillStyle = this.color;
					ctx.beginPath();
						ctx.arc(this.x, this.y, this.r, 0, 2 * Math.PI);
					ctx.closePath();
					ctx.fill();
				}
			}
			
			var xhr;
			var range;
			
			var intervalID = -1;
			
			var canvas;
			var ctx;
			
			var circle;
			
			function main(){
				canvas = document.getElementById('canvas');
				ctx = canvas.getContext('2d');
				
				circle = new Circle(ctx, 0, 0, 5, "red");
				
				range = canvas.width - 2 * circle.r;
				
				xhr = new XMLHttpRequest();
				xhr.onreadystatechange = () => {
					if(xhr.readyState === 4){ // si la requête est complétée (ie. on a reçu la réponse)
						let x = circle.r;
						let y = circle.r;
						
						//console.log(xhr.responseText);
						
						if(xhr.responseTpe === "json"){
							x += xhr.response.x;
							y += xhr.response.y;
						} else {
							let resp = JSON.parse(xhr.responseText);
							x += resp.x;
							y += resp.y;
						}
						
						circle.setPosition(x, y);
						
						update();
						render();
					}
				};
			
				intervalID = setInterval(sendRequest, 1000);
			}
			
			function sendRequest(){
				xhr.open("GET", "https://stwom.herokuapp.com/" + range, true);
				xhr.send();
			}
			
			function update(){
				
			}
			
			function render(){
				ctx.fillStyle = "white";
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				
				circle.draw();
			}
		</script>
	</head>

	<body onload="main()">
		<header>
			<h1>Site de Louri</h1>
		</header>

		<nav class="flex-list">
			<ul>
				<li><a href="js/index_js.html">Javascript</a></li>
				<li><a href="python/index_python.html">Python</a></li>
				<li><a href="index.html">Accueil</a></li>
			</ul>
		 </nav>

		 <main>
			<article>
				<div class="article-body">
					<p>En utilisant XHR :</p>
					<canvas id="canvas" width="600" height="600"></canvas>
				</div>
			</article>
		</main>

		<footer>
			<p>©Copyright: All Rights Reserved</p>
		</footer>

	</body>
</html>